You are a senior full-stack engineer and production architect.

We are rebuilding GymSaathi’s Workout Planner module. Do NOT assume anything not written here. Do NOT claim “complete” unless you verify by running the app and showing what was tested.

IMPORTANT:
- Treat this as a GREENFIELD feature if needed.
- Delete/ignore any old workout planner implementation if it conflicts.
- The system is multi-tenant: every query must be scoped by BOTH memberId and gymId.
- No IDOR: member must never access another member’s sessions or reports.

========================================================
A) PRODUCT SPEC (MUST IMPLEMENT EXACTLY)
========================================================

1) Onboarding (3 steps, mandatory before access)
- fitnessGoal (string/enum)
- experienceLevel: beginner | intermediate | expert
- trainingPriority: strength | stamina | flexibility

Store onboarding in member profile (or dedicated member_workout_profile table).
Workout Planner Home is inaccessible until onboarding completed.

2) Workout Planner Home Screen
A) KPI dashboard:
- member name
- current weight: from latest workout report if available, else from profile
- height: from profile
- streak / activity indicators derived ONLY from saved workout reports
B) Two actions:
- Training Session
- Get Report

3) Training Session Flow (On-demand, no fixed plans)
Member selects any muscle group and starts a session.

Muscle groups (show in UI):
- Abs, Back, Biceps, Chest, Forearms, Glutes, Hip Flexors,
  Lower Abs, Neck, Posterior Thighs, Quads, Shoulders, Triceps

Exercise library scale expectations (for backend capacity only, not hard-coded limits):
Abs 70, Back 153, Biceps 38, Chest 64, Forearms 32, Glutes 168,
Hip Flexors 20, Lower Abs 22, Neck 8, Posterior Thighs 99,
Quads 96, Shoulders 150, Triceps 38.

4) Stretching (MANDATORY FIRST, editable)
When muscle group selected:
- Suggest stretching first from stretching library for that muscle group.
Stretching counts available (library size expectation):
Abs 9, Back 21, Biceps 1, Chest 8, Forearms 0, Glutes 15,
Hip Flexors 12, Lower Legs 8, Neck 8, Posterior Thighs 18,
Quads 11, Shoulders 18, Triceps 1.

Member can replace stretching exercises ON THE SAME PAGE from the stretching library.

5) Main workout exercises (level-based + rotation)
Experience-based count:
- Beginner: 4–5
- Intermediate: 5–6
- Expert: 6–7

Rotation rule (CRITICAL):
- If a member repeats the same muscle group later, they should get different exercises.
- Track member exercise history per muscle group.
- Avoid repeating exercises used recently (define a reasonable window e.g., last 2 sessions for that muscle group).
- If the library is too small, fall back to least-recently-used selection (never return empty / never crash).

Member can replace any suggested main exercise ON THE SAME PAGE from the same muscle group library. Replacement must also update history appropriately.

6) Cardio (optional but always suggested)
Global cardio list:
Assault bike, Air bike, Battle ropes, Cross country, Ski erg, Cross trainer,
Elliptical, Cycling, Jump rope, Rowing machine, Running, Stair climber,
Swimming, Walking, Zig-zag, Sprint.

Rules:
- Suggest EXACTLY ONE cardio item every session.
- Cardio is OPTIONAL (member can skip).
- Log cardio only if performed.

7) Workout completion -> report
When workout completes:
- Create and save a report containing:
  date/time, muscle group,
  stretching exercises performed,
  main exercises performed,
  cardio performed or skipped,
  completion status.

Reports must be immutable snapshots:
- Store exercise name + metadata at time of completion (do not depend only on IDs that can change later).

8) Reports + calendar
Get Report screen:
- History list + day-wise reports
- Calendar view:
  green = workout completed
  red = no workout
Calendar must be derived ONLY from saved reports.

9) Superadmin Control (MUST BUILD)
Superadmin can manage exercise libraries:
- CRUD main exercises per muscle group
- CRUD stretching exercises per muscle group
- CRUD cardio exercises
- Activate/inactivate exercise (do not break old reports)
Changes should reflect immediately for new sessions.

10) Security requirements (MANDATORY)
- Every endpoint must scope by gymId + memberId.
- Member endpoints must never accept arbitrary memberId from client.
- All session/report fetch/update must verify ownership.
- Add shared helper to resolve memberId+gymId from authenticated session.

========================================================
B) IMPLEMENTATION REQUIREMENTS
========================================================

Deliverables:
1) Database schema tables + relations + indexes
2) Backend API endpoints:
   - onboarding get/set
   - generate session for muscle group (includes stretching + main + cardio)
   - replace exercise (stretching/main)
   - mark exercise complete/skip
   - complete session -> create report
   - reports list + report detail
   - calendar summary endpoint
   - superadmin CRUD for libraries
3) Frontend React UI:
   - onboarding wizard
   - home KPI dashboard + buttons
   - training session muscle group picker
   - session runner UI (stretching step enforced first)
   - replacement UI on same page
   - report views + calendar
   - superadmin library screens

Quality gates (do not skip):
- Add validation: counts range per level, muscle group must exist, library empty states.
- Add robust error handling and consistent API responses.
- Add tests or at minimum a manual verification checklist with endpoints tested.

========================================================
C) DO NOT DO
========================================================
- Do not create 7/30 day fixed plans.
- Do not auto-assign days.
- Do not assume trainer involvement.
- Do not say “completed” without running and checking flows.

========================================================
D) EXECUTION INSTRUCTIONS
========================================================
1) First: inspect the current codebase for any existing workout routes/components and decide whether to replace or refactor.
2) Then implement schema + migrations.
3) Implement backend APIs with strict tenant isolation.
4) Implement frontend.
5) Provide a final “Verified checklist” showing what routes/pages were run and validated.

Start now.
